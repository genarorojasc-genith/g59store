{% extends 'base.html' %}
{% load moneda %}

{% block title %}Carrito - G59 Store{% endblock %}

{% block content %}
<h1 class="text-2xl font-semibold mb-6 text-gray-900">
    Carrito de compras
</h1>

{% if cart|length > 0 %}
<div class="overflow-x-auto bg-white shadow sm:rounded-lg">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Producto
                </th>
                <th scope="col" class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Cantidad
                </th>
                <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Precio
                </th>
                <th scope="col" class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Total
                </th>
                <th scope="col" class="px-4 py-3"></th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            {% for item in cart %}
            <tr>
                <td class="px-4 py-3 text-sm text-gray-900">
                    {{ item.producto.nombre }}
                </td>

                <td class="px-4 py-3">
                    <form method="post"
                          action="{% url 'carrito:actualizar' item.producto.id %}"
                          class="flex justify-center">
                        {% csrf_token %}
                        <input 
                            type="number" 
                            name="quantity" 
                            value="{{ item.quantity }}" 
                            min="1"
                            class="w-20 border border-gray-300 rounded-md text-center text-sm px-2 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                            onchange="this.form.submit()"
                        >
                    </form>
                </td>

                <td class="px-4 py-3 text-right text-sm text-gray-700">
                    {{ item.precio|formato_pesos }}
                </td>
                <td class="px-4 py-3 text-right text-sm font-medium text-gray-900">
                    {{ item.total|formato_pesos }}
                </td>
                <td class="px-4 py-3 text-right text-sm">
                    <form method="post" action="{% url 'carrito:eliminar' item.producto.id %}">
                        {% csrf_token %}
                        <button 
                            type="submit"
                            class="inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-md border border-red-300 text-red-600 hover:bg-red-50 transition"
                        >
                            Quitar
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
            <tr class="bg-gray-50">
                <th colspan="3" class="px-4 py-3 text-right text-sm font-semibold text-gray-900">
                    Total:
                </th>
                <th class="px-4 py-3 text-right text-sm font-semibold text-gray-900">
                    {{ cart.get_total_price|formato_pesos }}
                </th>
                <th></th>
            </tr>
        </tbody>
    </table>
</div>

<div class="mt-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div>
        <a href="{% url 'productos:index' %}" 
           class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-md border border-gray-300 text-gray-700 bg-white hover:bg-gray-50 transition">
            Seguir comprando
        </a>
    </div>
    <div class="flex flex-wrap gap-3">
        <form method="post" action="{% url 'carrito:vaciar' %}">
            {% csrf_token %}
            <button 
                type="submit"
                class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-md border border-red-300 text-red-600 bg-white hover:bg-red-50 transition"
            >
                Vaciar carrito
            </button>
        </form>
        <a href="{% url 'pedidos:checkout_iniciar' %}"   
        class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-md text-white bg-emerald-600 hover:bg-emerald-700 shadow-sm transition">
            Ir al checkout
        </a>
    </div>
</div>

{% else %}
<p class="text-gray-600 mb-4">
    Tu carrito está vacío.
</p>
<a href="{% url 'productos:index' %}" 
   class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 shadow-sm transition">
    Ver productos
</a>
{% endif %}

{% endblock %}
